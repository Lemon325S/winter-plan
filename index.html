<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é«˜ä¸€å¯’å‡æ¯æ—¥è®¡åˆ’æ‰“å¡</title>
    <!-- å¼•å…¥Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- ä¿®å¤favicon 404æŠ¥é”™ -->
    <link rel="icon" href="data:,">
    <style>
        /* åŸºç¡€æ ·å¼ï¼ˆä¿ç•™é«˜çº§UI+ç§»åŠ¨ç«¯é€‚é…ï¼‰ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
        }

        :root {
            --primary-color: #4361ee;
            --primary-light: #7209b7;
            --success-color: #38b000;
            --bg-color: #f8f9fa;
            --card-bg: #ffffff;
            --text-primary: #2d3748;
            --text-secondary: #718096;
            --border-color: #e2e8f0;
            --shadow-sm: 0 2px 4px rgba(0,0,0,0.05);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.08);
            --shadow-lg: 0 8px 24px rgba(0,0,0,0.12);
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
        }

        html {
            font-size: 16px;
            @media (max-width: 768px) {
                font-size: 14px;
            }
            @media (max-width: 480px) {
                font-size: 12px;
            }
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4eaf5 100%);
            min-height: 100vh;
            padding: 1rem;
            color: var(--text-primary);
        }

        .container {
            max-width: 100%;
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            background: var(--card-bg);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            padding: 1.5rem;
            overflow: hidden;
        }

        h1 {
            text-align: center;
            background: linear-gradient(90deg, var(--primary-color), var(--primary-light));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-size: 1.8rem;
            margin-bottom: 1.5rem;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        /* åŠŸèƒ½åˆ‡æ¢æŒ‰é’® */
        .func-toggle {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .func-btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: var(--radius-sm);
            background: var(--bg-color);
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .func-btn.active {
            background: linear-gradient(90deg, var(--primary-color), var(--primary-light));
            color: white;
        }

        /* æ—¥æœŸé€‰æ‹©å™¨ */
        .day-selector {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            overflow-x: auto;
            padding-bottom: 0.5rem;
            scrollbar-width: none;
        }

        .day-selector::-webkit-scrollbar {
            display: none;
        }

        .day-btn {
            padding: 0.6rem 1.2rem;
            border: none;
            border-radius: var(--radius-sm);
            background-color: var(--bg-color);
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 1rem;
            font-weight: 500;
            white-space: nowrap;
            box-shadow: var(--shadow-sm);
        }

        .day-btn.active {
            background: linear-gradient(90deg, var(--primary-color), var(--primary-light));
            color: white;
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        /* ä»»åŠ¡æ¿å— */
        .task-section {
            margin-bottom: 1.5rem;
            background: var(--bg-color);
            border-radius: var(--radius-md);
            padding: 1rem;
            box-shadow: var(--shadow-sm);
        }

        .section-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #e8f0fe;
            display: flex;
            align-items: center;
        }

        .section-title::before {
            content: "";
            display: inline-block;
            width: 0.4rem;
            height: 1.2rem;
            background: linear-gradient(180deg, var(--primary-color), var(--primary-light));
            border-radius: 4px;
            margin-right: 0.5rem;
        }

        /* ä»»åŠ¡åˆ—è¡¨ */
        .task-list {
            list-style: none;
        }

        .task-item {
            display: flex;
            align-items: center;
            padding: 1rem;
            margin-bottom: 0.8rem;
            background-color: white;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid var(--border-color);
            gap: 1rem;
        }

        .task-item.completed {
            background-color: #f0fdf4;
            border-color: #bbf7d0;
            text-decoration: line-through;
            color: var(--text-secondary);
        }

        .task-time {
            min-width: 5rem;
            width: 6rem;
            font-weight: 500;
            color: var(--primary-color);
            font-size: 0.95rem;
        }

        .task-content {
            flex: 1;
            font-size: 1rem;
            line-height: 1.4;
        }

        .task-check {
            width: 1.8rem;
            height: 1.8rem;
            border: 2px solid var(--primary-color);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-color);
            font-weight: bold;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }

        .task-item.completed .task-check {
            background: linear-gradient(90deg, var(--success-color), #16a34a);
            border-color: var(--success-color);
            color: white;
        }

        /* ä»»åŠ¡ç®¡ç†è¡¨å• */
        .task-form {
            background: var(--bg-color);
            border-radius: var(--radius-md);
            padding: 1rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow-sm);
            display: none;
        }

        .task-form.active {
            display: block;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
            font-weight: 500;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            font-size: 1rem;
            background: white;
        }

        .form-actions {
            display: flex;
            gap: 0.5rem;
            justify-content: flex-end;
        }

        .btn {
            padding: 0.6rem 1.2rem;
            border: none;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 1rem;
        }

        .btn-primary {
            background: linear-gradient(90deg, var(--primary-color), var(--primary-light));
            color: white;
        }

        .btn-secondary {
            background: var(--bg-color);
            color: var(--text-primary);
        }

        /* åŠ è½½æç¤º */
        .loading {
            text-align: center;
            padding: 2rem;
            color: var(--text-secondary);
            display: none;
        }

        .loading.active {
            display: block;
        }

        /* åº†ç¥å¼¹çª— */
        .celebration {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            backdrop-filter: blur(4px);
        }

        .celebration-content {
            background: white;
            padding: 2rem;
            border-radius: var(--radius-lg);
            text-align: center;
            animation: pop 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            max-width: 90%;
            width: 400px;
            box-shadow: var(--shadow-lg);
        }

        @keyframes pop {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        .celebration h2 {
            background: linear-gradient(90deg, var(--success-color), #16a34a);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }

        /* ç§»åŠ¨ç«¯é€‚é… */
        @media (max-width: 480px) {
            .container {
                padding: 1rem;
            }

            h1 {
                font-size: 1.5rem;
            }

            .task-item {
                padding: 0.8rem;
                gap: 0.5rem;
            }

            .task-time {
                min-width: 4rem;
                width: 5rem;
                font-size: 0.9rem;
            }

            .task-check {
                width: 1.5rem;
                height: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>é«˜ä¸€å¯’å‡æ¯æ—¥è®¡åˆ’æ‰“å¡</h1>
        
        <!-- åŠŸèƒ½åˆ‡æ¢ï¼šæ‰“å¡/ç®¡ç†ä»»åŠ¡ -->
        <div class="func-toggle">
            <button class="func-btn active" id="btn-check">æ‰“å¡æ¨¡å¼</button>
            <button class="func-btn" id="btn-manage">ç®¡ç†ä»»åŠ¡</button>
        </div>

        <!-- æ—¥æœŸé€‰æ‹©å™¨ -->
        <div class="day-selector">
            <button class="day-btn active" data-day="å‘¨ä¸€">å‘¨ä¸€</button>
            <button class="day-btn" data-day="å‘¨äºŒ">å‘¨äºŒ</button>
            <button class="day-btn" data-day="å‘¨ä¸‰">å‘¨ä¸‰</button>
            <button class="day-btn" data-day="å‘¨å››">å‘¨å››</button>
            <button class="day-btn" data-day="å‘¨äº”">å‘¨äº”</button>
            <button class="day-btn" data-day="å‘¨å…­">å‘¨å…­</button>
            <button class="day-btn" data-day="å‘¨æ—¥">å‘¨æ—¥</button>
        </div>

        <!-- ä»»åŠ¡ç®¡ç†è¡¨å• -->
        <div class="task-form" id="taskForm">
            <div class="form-group">
                <label for="taskDay">æ˜ŸæœŸ</label>
                <select id="taskDay">
                    <option value="å‘¨ä¸€">å‘¨ä¸€</option>
                    <option value="å‘¨äºŒ">å‘¨äºŒ</option>
                    <option value="å‘¨ä¸‰">å‘¨ä¸‰</option>
                    <option value="å‘¨å››">å‘¨å››</option>
                    <option value="å‘¨äº”">å‘¨äº”</option>
                    <option value="å‘¨å…­">å‘¨å…­</option>
                    <option value="å‘¨æ—¥">å‘¨æ—¥</option>
                </select>
            </div>
            <div class="form-group">
                <label for="taskTime">æ—¶é—´æ®µ</label>
                <input type="text" id="taskTime" placeholder="ä¾‹å¦‚ï¼š08:30-09:00">
            </div>
            <div class="form-group">
                <label for="taskContent">ä»»åŠ¡å†…å®¹</label>
                <textarea id="taskContent" rows="2" placeholder="è¾“å…¥ä»»åŠ¡å†…å®¹"></textarea>
            </div>
            <div class="form-actions">
                <button class="btn btn-secondary" id="btn-clear">æ¸…ç©º</button>
                <button class="btn btn-primary" id="btn-save">ä¿å­˜ä»»åŠ¡</button>
            </div>
        </div>

        <!-- åŠ è½½æç¤º -->
        <div class="loading active" id="loading">
            åŠ è½½ä¸­...
        </div>

        <!-- ä»»åŠ¡åˆ—è¡¨å®¹å™¨ -->
        <div id="task-container">
            <!-- åŠ¨æ€ç”Ÿæˆ -->
        </div>
    </div>

    <!-- åº†ç¥å¼¹çª— -->
    <div class="celebration" id="celebration">
        <div class="celebration-content">
            <h2>ğŸ‰ å¤ªæ£’äº†ï¼ä»Šå¤©çš„ä»»åŠ¡å…¨éƒ¨å®Œæˆå•¦ï¼</h2>
            <p>ç»§ç»­ä¿æŒï¼Œä½ è¶…æ£’çš„ï¼</p>
            <button class="btn btn-primary" onclick="closeCelebration()">å…³é—­</button>
        </div>
    </div>

    <script>
        // ==================== æ ¸å¿ƒä¿®å¤ï¼šåªå®šä¹‰ä¸€æ¬¡Supabase ====================
        // æ›¿æ¢ä¸ºä½ çš„Supabaseä¿¡æ¯ï¼ˆå¿…å¡«ï¼ï¼‰
        const supabaseUrl = "https://ydvzwsfowkyquqoigrmg.supabase.co;
        const supabaseAnonKey = "sb_publishable_vJdssfr65laQD2c8PvTSRw_bxbsC3re";
        // åªåˆå§‹åŒ–ä¸€æ¬¡Supabaseå®¢æˆ·ç«¯
        const supabase = window.supabase.createClient(supabaseUrl, supabaseAnonKey);

        let currentDay = "å‘¨ä¸€";
        let currentMode = "check"; // check:æ‰“å¡æ¨¡å¼ï¼Œmanage:ç®¡ç†æ¨¡å¼

        // é¡µé¢åˆå§‹åŒ–
        async function init() {
            try {
                // ç»‘å®šæ‰€æœ‰äº‹ä»¶ï¼ˆä¼˜å…ˆç»‘å®šï¼Œç¡®ä¿äº¤äº’å¯ç”¨ï¼‰
                bindEvents();
                // åŠ è½½ä»»åŠ¡
                await loadTasks(currentDay);
            } catch (error) {
                console.error("åˆå§‹åŒ–å¤±è´¥ï¼š", error);
                document.getElementById('loading').style.display = 'none';
                document.getElementById('task-container').innerHTML = `
                    <div style="text-align:center; padding:2rem; color:#ef4444;">
                        åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥Supabaseé…ç½®æˆ–ç½‘ç»œ<br>
                        é”™è¯¯ä¿¡æ¯ï¼š${error.message || 'æœªçŸ¥é”™è¯¯'}
                    </div>
                `;
            }
        }

        // ç»‘å®šæ‰€æœ‰äº‹ä»¶ï¼ˆç¡®ä¿ä¼˜å…ˆæ‰§è¡Œï¼Œäº¤äº’ä¸é˜»å¡ï¼‰
        function bindEvents() {
            // åŠŸèƒ½åˆ‡æ¢
            document.getElementById('btn-check').addEventListener('click', async () => {
                currentMode = "check";
                document.querySelectorAll('.func-btn').forEach(btn => btn.classList.remove('active'));
                document.getElementById('btn-check').classList.add('active');
                document.getElementById('taskForm').classList.remove('active');
                // æ˜¾ç¤ºåŠ è½½ï¼Œé¿å…å¡é¡¿
                document.getElementById('loading').classList.add('active');
                await loadTasks(currentDay);
                document.getElementById('loading').classList.remove('active');
            });

            document.getElementById('btn-manage').addEventListener('click', async () => {
                currentMode = "manage";
                document.querySelectorAll('.func-btn').forEach(btn => btn.classList.remove('active'));
                document.getElementById('btn-manage').classList.add('active');
                document.getElementById('taskForm').classList.add('active');
                // æ˜¾ç¤ºåŠ è½½
                document.getElementById('loading').classList.add('active');
                await loadTasks(currentDay);
                document.getElementById('loading').classList.remove('active');
            });

            // æ—¥æœŸé€‰æ‹©ï¼ˆæ·»åŠ é˜²é‡å¤ç‚¹å‡»ï¼‰
            document.querySelectorAll('.day-btn').forEach(btn => {
                btn.addEventListener('click', async () => {
                    if (btn.classList.contains('active')) return;
                    document.querySelectorAll('.day-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentDay = btn.dataset.day;
                    // æ˜¾ç¤ºåŠ è½½
                    document.getElementById('loading').classList.add('active');
                    await loadTasks(currentDay);
                    document.getElementById('loading').classList.remove('active');
                });
            });

            // ä»»åŠ¡è¡¨å•äº‹ä»¶
            document.getElementById('btn-save').addEventListener('click', saveTask);
            document.getElementById('btn-clear').addEventListener('click', clearForm);
        }

        // åŠ è½½æŒ‡å®šæ—¥æœŸçš„ä»»åŠ¡ï¼ˆæ·»åŠ é”™è¯¯å¤„ç†ï¼‰
        async function loadTasks(day) {
            const container = document.getElementById('task-container');
            container.innerHTML = '';

            try {
                // ä»Supabaseè·å–ä»»åŠ¡
                const { data: tasks, error } = await supabase
                    .from('tasks')
                    .select('*')
                    .eq('day', day)
                    .order('time');

                if (error) throw error;

                if (tasks.length === 0) {
                    container.innerHTML = `<div style="text-align:center; padding:2rem; color:var(--text-secondary);">æš‚æ— ä»»åŠ¡ï¼Œå¯åœ¨ç®¡ç†æ¨¡å¼æ·»åŠ </div>`;
                    return;
                }

                // æŒ‰æ—¶æ®µåˆ†ç»„
                const sections = {
                    "ä¸Šåˆ": [],
                    "ä¸­åˆ": [],
                    "ä¸‹åˆ": [],
                    "æ™šä¸Š": []
                };

                tasks.forEach(task => {
                    const hour = parseInt(task.time.split('-')[0]?.split(':')[0] || 0);
                    if (hour >= 9 && hour < 12) sections["ä¸Šåˆ"].push(task);
                    else if (hour >= 12 && hour < 14) sections["ä¸­åˆ"].push(task);
                    else if (hour >= 14 && hour < 18) sections["ä¸‹åˆ"].push(task);
                    else sections["æ™šä¸Š"].push(task);
                });

                // æ¸²æŸ“ä»»åŠ¡
                for (const [sectionName, sectionTasks] of Object.entries(sections)) {
                    if (sectionTasks.length === 0) continue;

                    const sectionEl = document.createElement('div');
                    sectionEl.className = 'task-section';

                    const titleEl = document.createElement('div');
                    titleEl.className = 'section-title';
                    titleEl.textContent = sectionName;
                    sectionEl.appendChild(titleEl);

                    const listEl = document.createElement('ul');
                    listEl.className = 'task-list';

                    for (const task of sectionTasks) {
                        // è·å–æ‰“å¡çŠ¶æ€
                        const { data: checkin } = await supabase
                            .from('checkins')
                            .select('is_completed, id')
                            .eq('task_id', task.id)
                            .eq('user_id', 'default_user')
                            .single();

                        const isCompleted = checkin?.is_completed || false;

                        const itemEl = document.createElement('li');
                        itemEl.className = `task-item ${isCompleted ? 'completed' : ''}`;
                        itemEl.dataset.taskId = task.id;

                        // ç®¡ç†æ¨¡å¼æ˜¾ç¤ºåˆ é™¤æŒ‰é’®
                        const deleteBtn = currentMode === 'manage' 
                            ? `<span style="color:#ef4444; cursor:pointer; margin-left:0.5rem;" onclick="deleteTask('${task.id}')">ğŸ—‘ï¸</span>` 
                            : '';

                        itemEl.innerHTML = `
                            <span class="task-time">${task.time}</span>
                            <span class="task-content">${task.content}${deleteBtn}</span>
                            <span class="task-check">${isCompleted ? 'âœ“' : ''}</span>
                        `;

                        // æ‰“å¡æ¨¡å¼å¯ç‚¹å‡»æ‰“å¡
                        if (currentMode === 'check') {
                            itemEl.addEventListener('click', () => toggleCheckin(task.id, itemEl));
                        }

                        listEl.appendChild(itemEl);
                    }

                    sectionEl.appendChild(listEl);
                    container.appendChild(sectionEl);
                }

                // æ£€æŸ¥æ˜¯å¦å…¨éƒ¨å®Œæˆ
                await checkAllCompleted(day);
            } catch (error) {
                console.error("åŠ è½½ä»»åŠ¡å¤±è´¥ï¼š", error);
                container.innerHTML = `
                    <div style="text-align:center; padding:2rem; color:#ef4444;">
                        åŠ è½½ä»»åŠ¡å¤±è´¥<br>
                        è¯·æ£€æŸ¥Supabaseé…ç½®å’Œè¡¨æƒé™
                    </div>
                `;
            } finally {
                // éšè—åŠ è½½æç¤º
                document.getElementById('loading').classList.remove('active');
            }
        }

        // åˆ‡æ¢æ‰“å¡çŠ¶æ€ï¼ˆæ·»åŠ é˜²æŠ–ï¼‰
        let isToggling = false;
        async function toggleCheckin(taskId, itemEl) {
            if (isToggling) return;
            isToggling = true;

            try {
                // è·å–å½“å‰çŠ¶æ€
                const { data: checkin } = await supabase
                    .from('checkins')
                    .select('is_completed, id')
                    .eq('task_id', taskId)
                    .eq('user_id', 'default_user')
                    .single();

                const newState = !(checkin?.is_completed || false);

                if (checkin) {
                    // æ›´æ–°ç°æœ‰è®°å½•
                    await supabase
                        .from('checkins')
                        .update({ is_completed: newState, updated_at: new Date() })
                        .eq('id', checkin.id);
                } else {
                    // åˆ›å»ºæ–°è®°å½•
                    await supabase
                        .from('checkins')
                        .insert({
                            task_id: taskId,
                            user_id: 'default_user',
                            is_completed: newState
                        });
                }

                // æ›´æ–°UI
                itemEl.classList.toggle('completed', newState);
                itemEl.querySelector('.task-check').textContent = newState ? 'âœ“' : '';

                // æ£€æŸ¥æ˜¯å¦å…¨éƒ¨å®Œæˆ
                await checkAllCompleted(currentDay);
            } catch (error) {
                alert('æ‰“å¡å¤±è´¥ï¼š' + error.message);
            } finally {
                isToggling = false;
            }
        }

        // ä¿å­˜æ–°ä»»åŠ¡
        async function saveTask() {
            const day = document.getElementById('taskDay').value;
            const time = document.getElementById('taskTime').value.trim();
            const content = document.getElementById('taskContent').value.trim();

            if (!time || !content) {
                alert('æ—¶é—´æ®µå’Œä»»åŠ¡å†…å®¹ä¸èƒ½ä¸ºç©ºï¼');
                return;
            }

            try {
                // æ’å…¥æ•°æ®åº“
                const { error } = await supabase
                    .from('tasks')
                    .insert({
                        day,
                        time,
                        content
                    });

                if (error) throw error;

                alert('ä»»åŠ¡ä¿å­˜æˆåŠŸï¼');
                clearForm();
                // é‡æ–°åŠ è½½ä»»åŠ¡
                document.getElementById('loading').classList.add('active');
                await loadTasks(currentDay);
                document.getElementById('loading').classList.remove('active');
            } catch (error) {
                alert('ä¿å­˜å¤±è´¥ï¼š' + error.message);
            }
        }

        // åˆ é™¤ä»»åŠ¡
        async function deleteTask(taskId) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªä»»åŠ¡å—ï¼Ÿ')) return;

            try {
                const { error } = await supabase
                    .from('tasks')
                    .delete()
                    .eq('id', taskId);

                if (error) throw error;

                // é‡æ–°åŠ è½½ä»»åŠ¡
                document.getElementById('loading').classList.add('active');
                await loadTasks(currentDay);
                document.getElementById('loading').classList.remove('active');
            } catch (error) {
                alert('åˆ é™¤å¤±è´¥ï¼š' + error.message);
            }
        }

        // æ¸…ç©ºè¡¨å•
        function clearForm() {
            document.getElementById('taskTime').value = '';
            document.getElementById('taskContent').value = '';
        }

        // æ£€æŸ¥æ˜¯å¦å…¨éƒ¨å®Œæˆ
        async function checkAllCompleted(day) {
            try {
                // è·å–å½“å¤©æ‰€æœ‰ä»»åŠ¡
                const { data: tasks } = await supabase
                    .from('tasks')
                    .select('id')
                    .eq('day', day);

                if (!tasks || tasks.length === 0) return;

                // è·å–å·²å®Œæˆçš„ä»»åŠ¡æ•°
                let completedCount = 0;
                for (const task of tasks) {
                    const { data: checkin } = await supabase
                        .from('checkins')
                        .select('is_completed')
                        .eq('task_id', task.id)
                        .eq('user_id', 'default_user')
                        .single();

                    if (checkin?.is_completed) completedCount++;
                }

                // å…¨éƒ¨å®Œæˆåˆ™æ˜¾ç¤ºåº†ç¥å¼¹çª—
                if (completedCount === tasks.length && tasks.length > 0) {
                    setTimeout(() => {
                        document.getElementById('celebration').style.display = 'flex';
                    }, 500);
                }
            } catch (error) {
                console.error("æ£€æŸ¥å®ŒæˆçŠ¶æ€å¤±è´¥ï¼š", error);
            }
        }

        // å…³é—­åº†ç¥å¼¹çª—
        function closeCelebration() {
            document.getElementById('celebration').style.display = 'none';
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–ï¼ˆç¡®ä¿DOMåŠ è½½å®Œæ¯•ï¼‰
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
